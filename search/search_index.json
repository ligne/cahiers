{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Introduction","text":"<p>I'm one of those people who always has hundreds of open tabs across a dozen windows of multiple browsers. Partly this is because I'm bad at tidying them up when I'm done, but for the most part it's because they contain something that is useful (or that I feel might be useful), just not quite yet.</p> <p>I'm hoping that by writing them down here, I will be able to find them later when I actually need them.</p>"},{"location":"git/","title":"Git","text":"<p>Everyone's favourite VCS.</p>"},{"location":"git/#diff","title":"Diff","text":""},{"location":"git/#readable-diffs-of-binary-files","title":"Readable diffs of binary files","text":"<p>Well, binary-like files at least. Anything in a format that is not directly legible, in this case PEM-encoded certificates. Unlike smudge/clean filters this will not touch either the worktree file or its blob.</p> <p>First define a diff driver, either globally or locally: <code>git config diff.crt.textconv \"openssl x509 -noout -text -in\"</code>.</p> <p>Then add a pattern to associate the new driver with some files: <code>*.crt diff=crt</code>. This can go in <code>.gitattributes</code> or the local or global <code>attributes</code> files, depending on who might be interested in using it.</p> <p>Git will now convert the certificate into its textual form before feeding it to diff.</p> <p>More details here.</p>"},{"location":"git/#index","title":"Index","text":""},{"location":"git/#view-changes-to-the-index","title":"View changes to the index","text":"<p>By default <code>git diff</code> only shows unstaged changes. Add <code>--staged</code> to see what changes are staged for the next commit, or run <code>git diff HEAD</code> to see all changes relative to the last commit.</p>"},{"location":"git/#unstage-files","title":"Unstage files","text":"<p>This is just a simple <code>git reset</code>, or <code>git reset HEAD -- $file ...</code> to be more discerning.</p>"},{"location":"git/#commits","title":"Commits","text":""},{"location":"git/#undo-the-last-commit","title":"Undo the last commit","text":"<p>To undo the most recent commit ready for another try: <code>git reset --soft HEAD^</code>.</p> <p>The old commit will still be available as <code>ORIG_HEAD</code>. Add <code>-c ORIG_HEAD ...</code> when committing to use it as the basis of the new message.</p>"},{"location":"git/#squashing","title":"Squashing","text":"<p>In the general case this can be done an interactive rebase, and the last commit can be corrected with <code>git add ...; git commit --amend [--no-edit]</code>. But if the last few commits are a mess that need squashing into one, run <code>git reset --soft HEAD~n</code> and prepare the final commit.</p>"},{"location":"git/#branches","title":"Branches","text":""},{"location":"git/#turn-commits-into-a-new-branch","title":"Turn commits into a new branch","text":"<p>To turn the most recent commits into a new branch:</p> <pre><code>git branch new_branch\ngit reset --hard HEAD~3  # use the three most recent commits\ngit switch new_branch\n</code></pre>"},{"location":"git/#find-merged-branches","title":"Find merged branches","text":"<p>List all branches that have(n't) been merged into the current branch: <code>git branch --{,no-}merged</code>. Can specify a branch name to use instead, and <code>-r</code> and <code>-a</code> to show remote or all branches respectively. (source)</p>"},{"location":"git/#rename-a-branch","title":"Rename a branch","text":"<p>Change the branch name locally: <code>git branch --move old-name new-name</code>.</p> <p>If it also exists upstream, <code>git push --set-upstream origin new-name; git push origin --delete old-name</code>.</p>"},{"location":"git/#merging","title":"Merging","text":""},{"location":"git/#stash","title":"Stash","text":""},{"location":"git/#stash-and-the-index","title":"Stash and the index","text":"<p>By default <code>git stash [push]</code> will also stash the contents of the index. To only stash unstaged changes, add the <code>-k</code> option.</p> <p>Alternatively, it's possible to stash only staged changes with <code>-S</code>. This is equivalent to committing them to a new branch, but quicker (and arguably tidier).</p>"},{"location":"git/#converting-to-a-branch","title":"Converting to a branch","text":"<p>Useful when the stash entry can no longer be popped cleanly. <code>git stash branch testchanges</code>.</p>"},{"location":"git/#gitignore","title":".gitignore","text":"<p>If you add rules to ignore vim droppings and similar in <code>~/.config/git/ignore</code>, you don't need to add them to every project you create. It's obvious when you think about it, isn't it?</p> <p>There is a collection of per-language rules here.</p> <p>To ignore something that's only relevant locally or for a short time: <code>echo boring/ &gt;&gt; .git/info/exclude</code>. If it's a directory, doing <code>echo \\* &gt; boring/.gitignore</code> means the ignore will automatically get cleaned up when it's deleted. Some tools (including <code>uv</code>, <code>pytest</code> and <code>mypy</code>) do this automatically to their cache directories, so check before ignoring them explicitly.</p>"},{"location":"git/#repository-administration","title":"Repository administration","text":""},{"location":"git/#git-sizer","title":"git-sizer","text":"<p>Warns about possible size-related issues that can cause slowness.</p>"},{"location":"markdown/","title":"Markdown","text":"<p>The markup language this is written in.</p> <p>Cheat-sheets here and here.</p>"},{"location":"markdown/#pre-commit","title":"pre-commit","text":""},{"location":"markdown/#formatter","title":"Formatter","text":"<p><code>mdformat</code> is like <code>black</code> for Markdown files. Probably want to use it in conjunction with <code>mdformat-mkdocs</code>.</p> <p><code>.pre-commit-config.yaml</code> snippet here.</p> <p>There are a variety of plugins. For the most part these either format the contents of code blocks, or add support for Markdown extensions.</p>"},{"location":"mkdocs/","title":"MkDocs","text":"<p>MkDocs is the static site generator used for this site.</p>"},{"location":"mkdocs/#initialising","title":"Initialising","text":"<p>In a clean directory:</p> <pre><code>uv pip install mkdocs\nmkdocs new .\n</code></pre>"},{"location":"mkdocs/#editing","title":"Editing","text":"<p>Create Markdown files in the <code>docs/</code> directory.</p> <p>Non-markdown files can go alongside them and will be copied as-is.</p> <p>MkDocs comes with a test server that automatically reloads on changes:</p> <pre><code>mkdocs serve\n</code></pre>"},{"location":"mkdocs/#images","title":"Images","text":"<p>Put images in <code>docs/img/</code>. They can then be referenced with the usual syntax: <code>![alt text](img/name_of_file.png)</code>.</p> <p>Custom favicon: the standard MkDocs will use <code>docs/img/favicon.ico</code> if present. Material for MkDocs prefers <code>assets/images/favicon.png</code> but this can be overridden in the config.</p>"},{"location":"mkdocs/#css-and-javascript","title":"CSS and JavaScript","text":"<p>Like images, these go in the document root, for example in <code>docs/{js,css}/</code>. They then need to be listed in <code>mkdocs.yml</code>, using the path relative to the document root:</p> <pre><code>extra_css:\n  - css/blah.css\nextra_javascript:\n  - js/blah.js\n</code></pre>"},{"location":"mkdocs/#redirects","title":"Redirects","text":"<p>To avoid link-rot when moving pages about, use the <code>mkdocs-redirects</code> plugin:</p> <pre><code>plugins:\n  - redirects:\n      redirect_maps:\n        \"old-path.md\": \"new/path.md\"\n</code></pre> <p>However redirecting anchors needs to be done within the browser. See uv's codebase for one possible implementation.</p>"},{"location":"mkdocs/#navigation","title":"Navigation","text":"<p>Material for MkDocs has a lot of interesting options. If these are not enough, there's always Awesome Nav.</p>"},{"location":"mkdocs/#table-of-contents","title":"Table of contents","text":"<p>Each page gets a table of contents, populated with its sub-headings. By default the Material theme puts this in a secondary sidebar on the right-hand side.</p> <p>To collapse it into the main sidebar, use the <code>toc.integrate</code> feature. This is not compatible with the feature that allows sections to have their own index pages, <code>navigation.indexes</code>.</p> <p>Alternatively, it's possible to move the table of contents to the left by adding a custom CSS file to change the secondary sidebar's <code>order</code> property:</p> <pre><code>/* TOC on the left */\n.md-sidebar--secondary {\n  order: 0;\n}\n</code></pre> <p>This comes at the cost of having a big white space near the middle of the screen.</p>"},{"location":"mkdocs/#code-highlighting","title":"Code highlighting","text":"<p>First of all, this relies on code blocks being annotated with the language in use. (This is checked automatically by <code>markdownlint</code>.) In most cases this is just the name of the language. There is also <code>console</code>, for a series of commands (including prompts) interspersed with their output.</p> <p>A basic config looks like this:</p> mkdocs.yml<pre><code>  - pymdownx.highlight:\n      anchor_linenums: true\n  - pymdownx.superfences\n</code></pre> <p>As seen here, this also allows a filename (or other information) to be displayed, by adding a <code>title</code> attribute to the first line of the block.</p> <p>To highlight inline code blocks, enable the <code>pymdownx.inlinehilite</code> extension and start the block with <code>#!</code> followed by the language name.</p> <p>Full documentation here.</p>"},{"location":"mkdocs/#creation-and-revision-dates","title":"Creation and revision dates","text":"<p>Add and configure the plugin:</p> <pre><code>plugins:\n  - git-revision-date-localized:\n      enabled: !ENV [CI, false]\n      type: timeago\n      enable_creation_date: true\n      timezone: Europe/London\n</code></pre> <p>The Github action will also need tweaking.</p> <p>Not all themes support this out of the box (Material for MkDocs does).</p>"},{"location":"mkdocs/#deploying","title":"Deploying","text":"<p>Full documentation here. The gist is: run <code>mkdocs gh-deploy</code> and it will soon appear on your github site.</p> <p>There is a GitHub Action to do this.</p>"},{"location":"pre-commit/","title":"pre-commit","text":"<p>pre-commit is a tool for managing git hooks. It runs various checks automatically on every commit, preventing syntax or formatting errors from being introduced.</p>"},{"location":"pre-commit/#initialising","title":"Initialising","text":"<pre><code>uv tool install pre-commit  # installs it globally\npre-commit sample-config &gt; .pre-commit-config.yaml\npre-commit install\n</code></pre>"},{"location":"pre-commit/#configuring","title":"Configuring","text":"<p>Configuration goes in <code>.pre-commit-config.yaml</code>. Validate it with <code>pre-commit validate-config .pre-commit-config.yaml</code>. Documentation is here.</p>"},{"location":"pre-commit/#some-useful-hooks","title":"Some useful hooks","text":"<ul> <li>Markdown</li> <li>Spell-checking code and prose</li> <li>Many more here</li> </ul>"},{"location":"pre-commit/#custom-hooks","title":"Custom hooks","text":"<p>It's also possible to write your own.</p> <p>Most of the time, repository-local hooks should be sufficient. These are configured in <code>.pre-commit-config.yaml</code> using the settings here.</p> <ul> <li>The <code>fail</code> \"language\" will raise an error if it finds any matching files.     This can be used to enforce a file naming scheme.</li> <li>Use <code>pygrep</code> to check file contents using regexes.     There are some pre-canned rules here.</li> <li><code>script</code> and <code>system</code> run local and system-level commands respectively.     The former might be useful to wrap a custom lint command, via a script in the repository.     The latter could be used to invoke a tool that might reasonably be assumed to exist in the dev environment.     Either way, the command is specified with the <code>entry</code> key, including any arguments required.</li> </ul>"},{"location":"pre-commit/#operating","title":"Operating","text":"<p>It runs automatically before every commit, on the files being committed. If any of the hooks fail, the commit will be aborted.</p> <p>Many tools can automatically fix errors they find. For this reason it works best if the changes are added as a separate step before commit, as these changes can be reviewed with <code>git diff</code>.</p> <p>You can also run it manually with <code>pre-commit run</code>. By default this only operates on staged files; check specific files with <code>--files</code>, or select them all with <code>--all-files</code>.</p> <p>Even when invoked manually it will refuse to run while there are uncommitted changes to the configuration file. The <code>--files</code> or <code>--all-files</code> options override this.</p> <p>Occasionally run <code>pre-commit autoupdate</code> to keep the hooks up-to-date.</p>"},{"location":"pre-commit/#overriding","title":"Overriding","text":"<p>It's still possible to force a commit that would normally be rejected. Either <code>SKIP=hook1,hook2 git commit</code> to ignore specific hooks, or <code>git commit --no-verify</code> to ignore the whole lot.</p>"},{"location":"pre-commit/#troubleshooting","title":"Troubleshooting","text":"<p>Solutions to some common problems.</p>"},{"location":"spelling/","title":"Spelling","text":""},{"location":"spelling/#pre-commit","title":"pre-commit","text":"<p>The following tools play well with <code>pre-commit</code>:</p> <p><code>typos</code></p> <ul> <li>Aimed at finding common misspellings in code rather than acting as a general-purpose spellchecker.</li> <li>Very fast.</li> </ul> <p>Relatively few configuration options. It can use its own <code>.typos.toml</code>, but it can also be included in <code>pyproject.toml</code>.</p> <p><code>cspell</code></p> <ul> <li>Fully-fledged spellchecker, using a much more comprehensive dictionary.</li> <li>Significantly slower.</li> </ul> <p>Configure it using <code>.cspell.yaml</code>. A basic guide, including how to seed a local dictionary quickly, and a detailed reference. In addition to specifying additional project-local words, these custom dictionaries are very flexible.</p>"},{"location":"vim/","title":"Vim","text":""},{"location":"vim/#patterns","title":"Patterns","text":""},{"location":"vim/#nongreedy-quantifiers","title":"Nongreedy quantifiers","text":"<p>Quantifiers are greedy by default, as is correct.</p> <p>Vim doesn't support the usual <code>*?</code>/<code>+?</code> syntax, so to get nongreedy/lazy matching you have to use a variant of the general quantifiers. This involves appending a dash to the opening brace: instead of <code>\\{n,m}</code>, the greedy form, use <code>\\{-n,m}</code> to match lazily.</p> <p>As usual, <code>n</code> will default to 0 and <code>m</code> to unbounded; this means <code>\\{-}</code> is equivalent to <code>*?</code>, and <code>\\{-1,}</code> to <code>+?</code>.</p>"},{"location":"python/collections/","title":"Collections","text":""},{"location":"python/collections/#sets","title":"Sets","text":"<p>Docs</p>"},{"location":"python/collections/#modifying","title":"Modifying","text":"<ul> <li><code>s.add(element)</code> to add a single element, rather than <code>s | {element}</code>.</li> <li><code>s.remove(element)</code> will raise <code>KeyError</code> if <code>element</code> is not present.     Use <code>.discard(element)</code> if this doesn't matter.</li> </ul>"},{"location":"python/collections/#chaining-operations","title":"Chaining operations","text":"<ul> <li>All the methods except <code>.symmetric_difference()</code> can take multiple arguments.</li> <li>It's <code>s1 |= s2 | s3 ...</code> and <code>s1 &amp;= s2 &amp; s3</code>, but <code>s1 -= s2 | s3</code> (though this obviously means the same thing).</li> </ul> <p>To apply an operation to an arbitrary list of sets, you could do something like <code>first, *others = sets; s = first.union(*others)</code>. However <code>s = set.union(*sets)</code> is both more concise, and also works correctly when the <code>sets</code> list contains only one element.</p>"},{"location":"python/collections/#caveats","title":"Caveats","text":"<p>The operators require both operands to be <code>set</code> instances, but the methods can take anything iterable as an argument. This also applies when using them as class methods: only the first argument is required to be a set.</p> <p>Python's sorting algorithm only uses the objects' <code>.__lt__()</code> method. With sets, this determines whether one is a proper subset of the other and has nothing to do with ordering. Therefore <code>sorted([s1, s2, s3])</code> probably won't do what you want (sorting the content of a set does, of course).</p>"},{"location":"python/collections/#counter","title":"Counter","text":"<p>Docs</p>"},{"location":"python/collections/#mathematical-operations","title":"Mathematical operations","text":"<p><code>Counter</code>s can be combined using the <code>.update()</code> and <code>.subtract()</code> methods, which will perform in-place addition and subtraction between corresponding elements.</p> <p>There is also a second, operator-based interface that makes them behave like multisets. As such, the results of these operations will only include elements whose counts are greater than zero.</p> <ul> <li>Binary <code>+</code> and <code>-</code> do what you would expect.</li> <li>Unary <code>+</code> and <code>-</code> are equivalent to adding to/subtracting from an empty <code>Counter</code>.     This effectively selects only the positive and (the absolute values of) the negative elements, respectively.</li> <li>Binary <code>&amp;</code> and <code>|</code> return the minimum and maximum of each corresponding pair of elements.</li> </ul> <p>(In-place versions of these are also available.)</p> <p>The comparison operators (<code>&gt;</code>, <code>&gt;=</code>, <code>&lt;</code>, <code>&lt;=</code>) check for inclusion of one within the other, ie. that one is the subset of the other.</p>"},{"location":"python/libraries/","title":"Libraries","text":"<p>Top PyPI packages.</p>"},{"location":"python/libraries/#argparse","title":"argparse","text":"<p>Docs</p>"},{"location":"python/libraries/#complex-validation","title":"Complex validation","text":"<p>Sometimes there's no straightforward way to express the full validation rules within the confines of <code>.add_argument()</code>. In particular there's no guarantee that the arguments will be provided in any particular order, so Actions have to be able to work independently of each other.</p> <p>In such cases it can be better to defer validation until after the parser has run. If there are problems with the contents of the <code>Namespace</code> object, call <code>parser.error(\"...\")</code> to exit with a tidy and consistent usage message (source).</p> <p>(But it might be easier with Click).</p>"},{"location":"python/libraries/#datetype","title":"DateType","text":"<p>Wraps the <code>datetime</code> module to distinguish between <code>date</code> and <code>datetime</code>, and between timezone-aware and -na\u00efve datetimes. Recommended by the official documentation!</p> <p>There doesn't appear to be any documentation as such, but the repo does contain some examples.</p> <p>Repo</p>"},{"location":"python/libraries/#dbxs","title":"dbxs","text":"<p>Create a data-access layer by attaching raw SQL queries to functions at import-time. A bit like Asterisk's <code>func_odbc.conf</code>?</p> <p>It binds the function parameters to the placeholders, and automatically inflates the result(s) to (an iterator of) dataclasses. It can help prevent SQLI and improve type-safety.</p> <p>It's not stable yet, and in particular it only supports async database interfaces. (Though contra the README, it does support <code>asyncio</code> as well as Twisted.) But it could be useful as a very lightweight database layer when a full-blown ORM would be overkill.</p> <p>Docs | Repo</p>"},{"location":"python/libraries/#lz4","title":"lz4","text":"<p>Bindings for Yann Collet's LZ4 compression library.</p> <p>The <code>frame</code> interface deals with both the compressed data and its container, and <code>lz4.frame.open()</code> is probably what you want to use. The <code>block</code> interface deals with plain blocks of compressed data.</p> <p>Docs | Repo</p>"},{"location":"python/libraries/#lz4json","title":"lz4json","text":"<p>This is a variant of LZ4 used in various Mozilla projects. It pre-dates the full standardisation of the Frame format (hence needing special treatment), but is otherwise compliant.</p> <p>It comprises a fixed eight-byte header, followed by a single Block. Therefore to decode an <code>lz4json</code> file:</p> <pre><code>with open(filename, \"rb\") as fh:\n    if (magic := fh.read(8)) != b\"mozLz40\\0\":\n        print(f\"{filename}: Unrecognised magic number '{magic}'\")\n\n    payload = lz4.block.decompress(fh.read())\n</code></pre> <p>This is basically what <code>lz4jsoncat</code> does, except the bindings work out the sizes for you.</p> <p>(Note that there is a plan to (eventually) replace it with a more standard compression format.)</p>"},{"location":"python/libraries/#moto","title":"moto","text":"<p>Mocks for AWS services.</p> <p>Docs | Repo</p>"},{"location":"python/libraries/#msgspec","title":"msgspec","text":"<p>Fast serialisation and validation. Supports JSON, MessagePack, YAML, and TOML.</p> <p>Docs | Repo</p>"},{"location":"python/libraries/#pint","title":"pint","text":"<p>Associate quantities with physical units. These propagate through mathematical operations and can be converted.</p> <p>Docs | Repo</p>"},{"location":"python/libraries/#platformdirs","title":"platformdirs","text":"<p>Determine platform-specific directories for config files and user data. A fork of the sadly-unmaintained <code>appdirs</code>.</p> <p>Repo | Docs</p>"},{"location":"python/libraries/#pycountry","title":"pycountry","text":"<p>Wraps Debian's <code>iso-codes</code> data databases for ISO country, language, and script codes, along with their translations.</p> <p>Repo and docs</p>"},{"location":"python/libraries/#srt","title":"srt","text":"<p>Parsing and modifying SRT subtitles files, including time-shifting and combining multiple files into one. It also provides a command-line tool.</p> <p>An alternative is <code>pysrt</code>.</p> <p>Docs | Repo</p>"},{"location":"python/libraries/#stamina","title":"stamina","text":"<p>Decorator-based library for handling transient errors. Detects exceptions and retries with exponential backoff, capping the number of retries and total time. Basically just applies reasonable defaults to tenacity.</p> <p>Repo | Docs</p>"},{"location":"python/libraries/#svgpy","title":"svg.py","text":"<p>Simple, type-safe library for generating SVG files. It can also be used online.</p> <p>Docs and repo</p>"},{"location":"python/libraries/#uncertainties","title":"uncertainties","text":"<p>Calculate with automatic error propagation.</p> <p>Docs | Repo</p>"},{"location":"python/libraries/#yarl","title":"yarl","text":"<p>Parsing and modifying URLs with an immutable, <code>pathlib</code>-inspired API. It supports query string fields with multiple values, and automatically handles IDNA- and percent-encoding.</p> <p>Each part of the URL can be accessed individually, with variants for the encoded value (<code>raw_</code> prefix) and modifying/unsetting (<code>with_</code> prefix). Additionally, it overloads the <code>/</code> operator for concatenating paths and <code>%</code> for applying a dict of parameters.</p> <p>Docs | Repo</p>"},{"location":"python/tools/","title":"Tools","text":""},{"location":"python/tools/#isort","title":"isort","text":"<p>Sorts and formats import statements.</p>"},{"location":"python/tools/#configuration","title":"Configuration","text":"<p>There are various choices of file but the most convenient is to use the local <code>pyproject.toml</code>.</p> <p>It's useful to have a default global config in a <code>.isort.cfg</code> file, that sets <code>profile = black</code> (to play nicely) and <code>float_to_top = true</code> (for convenience). But it doesn't specifically look for it in <code>$HOME</code>: it just walks up the tree until it finds a suitable file. This means that it won't be used if you're not under your home directory (such as on WSL). It also stops when it finds a <code>.git/</code> or <code>.hg/</code> directory, so it won't work in a repository either.</p>"},{"location":"python/tools/#modifying-imports","title":"Modifying imports","text":"<p>It can also add and remove imports, which is handy for bulk operations. Since it knows about the various ways an import statement can be organised it can do a much more precise job than <code>sed</code> realistically could.</p> <p>They can be chained in the same operation, eg.: <code>isort --add pathlib.Path --add sys --rm \"__future__.generator_stop\" $(git ls-files '*.py')</code>.</p>"},{"location":"python/tools/#pydeps","title":"pydeps","text":"<p>Visualise module dependency trees using Graphviz. Although it's primarily intended to be used as a command-line tool, it does provide an API and readable intermediate format.</p> <p>Repo | Docs</p>"}]}